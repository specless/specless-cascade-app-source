{"version":3,"sources":["modules/project.js"],"names":[],"mappings":"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","file":"modules/project.js","sourcesContent":["var spawn = require('child_process').spawn;\nvar Q = require('q');\nvar jetpack = require('fs-jetpack');\nvar open = require(\"open\");\nconst EventEmitter = require('events');\nconst util = require('util');\n\nimport { utils } from './utils';\n\nexport var Project = function (path, cb, name) {\n\n\tvar self = this;\n\tvar app = global.app;\n\n\tself.path = path;\n\n\tself.get = function (type, callback) {\n\t\tvar settingsFile = self.path + '/' + app.cascade.get('settingsFileName');\n\t\tvar settings = jetpack.read(settingsFile, 'json');\n\t\tself.emit('get');\n\t\tif (type === 'settings') {\n\t\t\tif (callback) {\n\t\t\t\tcallback(settings);\n\t\t\t}\n\t\t\tself.emit('get:settings');\n\t\t\treturn settings\n\n\t\t} else if (type === undefined) {\n\t\t\tif (callback) {\n\t\t\t\tcallback(self);\n\t\t\t}\n\t\t\tself.emit('get:self');\n\t\t\treturn self\n\t\t} else {\n\t\t\tif (callback) {\n\t\t\t\tcallback(settings[type]);\n\t\t\t}\n\t\t\tself.emit('get:' + type);\n\t\t\treturn settings[type]\n\t\t}\n\t}\n\n\tself.set = function (key, value, callback) {\n\t\tvar settingsFile = self.path + '/' + app.cascade.get('settingsFileName');\n\t\tvar settings = jetpack.read(settingsFile, 'json');\n\t\tsettings[key] = value;\n\t\tjetpack.write(settingsFile, settings);\n\t\tif (callback) {\n\t\t\tcallback(settings[key]);\n\t\t}\n\t\tself.emit('set');\n\t\tself.emit('set:' + key);\n\t\treturn settings[key];\n\t}\n\n\tself.preview = function (target) {\n\t\tif (target === undefined) {\n\t\t\topen(\"http://localhost:\" + app.get('serverPort') + \"/\");\n\t\t} else {\n\t\t\topen(\"http://localhost:\" + app.get('serverPort') + \"/\", target);\n\t\t}\n\t}\n\n\tself.viewIn = function (target) {\n\t\tif (target === undefined) {\n\t\t\topen(app.project.get('path'), 'finder');\n\t\t} else {\n\t\t\topen(app.project.get('path'), target);\n\t\t}\n\t}\n\n\tself.publish = function (callback) {\n\t\tself.emit('publishStart');\n\t\tapp.cascade._run('publish', function(success) {\n\t\t\tif (success === true) {\n\t\t\t\tif (callback) {callback(success)}\n\t\t\t\tself.emit('publish');\n\t\t\t\tself.emit('publishEnd');\n\t\t\t\topen(app.project.get('path'), 'finder');\n\t\t\t} else if (success === false) {\n\t\t\t\tif (callback) {callback(success)}\n\t\t\t\tself.emit('publishEnd');\n\t\t\t\tself.emit('publish:fail');\n\t\t\t}\n\t\t});\n\t}\n\n\tself._init = function (callback) {\n\t\tif (name) {\n\t\t\tutils.handleMessage(\"Creating new project at '\" + path + \"'.\", 0);\n\t\t\tapp.cascade.create(path, name, function (success) {\n\t\t\t\tif (success === false) {\n\t\t\t\t\tutils.handleMessage(\"Failed to create project.\", 0);\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(false);\n\t\t\t\t\t}\n\t\t\t\t\tself.emit('init:fail');\n\t\t\t\t\treturn false\n\t\t\t\t} else {\n\t\t\t\t\tself.path = path + '/' + name;\n\t\t\t\t\tutils.handleMessage(\"Project created.\", 0);\n\t\t\t\t\tapp.cascade.start(self.path, function(status) {\n\t\t\t\t\t\tif (status === 'started') {\n\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\tcallback(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself.emit('init');\n\t\t\t\t\t\t\treturn true\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tutils.handleMessage(\"Opening existing project at '\" + self.path + \"'.\", 0);\n\t\t\tapp.cascade.start(self.path, function(status) {\n\t\t\t\tif (status === 'started') {\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(true);\n\t\t\t\t\t}\n\t\t\t\t\tself.emit('init');\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tself._init(cb);\n}\n\nutil.inherits(Project, EventEmitter);"],"sourceRoot":"/source/"}